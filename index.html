<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neon Dash: GOD MODE</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; user-select: none; }
        body { background: #000; overflow: hidden; font-family: 'Orbitron', sans-serif; color: white; touch-action: none; }
        
        canvas { display: block; width: 100%; height: 100%; }

        /* UI –°–õ–û–ò */
        .screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(5px);
            transition: opacity 0.3s; z-index: 10;
        }
        .hidden { opacity: 0; pointer-events: none; }
        
        /* –ö–ù–û–ü–ö–ò */
        .btn {
            background: linear-gradient(90deg, #00f260, #0575e6);
            border: none; color: white; padding: 15px 40px; font-size: 20px;
            border-radius: 50px; margin: 10px; cursor: pointer; font-weight: 900;
            text-transform: uppercase; box-shadow: 0 0 20px rgba(5, 117, 230, 0.5);
            transition: transform 0.1s;
        }
        .btn:active { transform: scale(0.95); }
        .btn-shop { background: linear-gradient(90deg, #ff00cc, #333399); box-shadow: 0 0 20px rgba(255, 0, 204, 0.5); }
        .btn-small { padding: 8px 20px; font-size: 14px; min-width: 100px; background: #333; box-shadow: none; }

        /* HUD */
        #hud { position: absolute; top: 0; left: 0; width: 100%; padding: 15px; display: flex; justify-content: space-between; z-index: 5; pointer-events: none; font-weight: bold; font-size: 20px; text-shadow: 0 2px 4px #000; }
        .powerup-icon { font-size: 24px; margin-left: 10px; opacity: 0.5; }
        .active-pw { opacity: 1; filter: drop-shadow(0 0 5px #fff); transform: scale(1.2); }

        /* –ú–ê–ì–ê–ó–ò–ù */
        .shop-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; max-height: 50vh; overflow-y: auto; padding: 10px; width: 100%; max-width: 400px; }
        .item { background: rgba(255,255,255,0.1); border: 2px solid #333; border-radius: 10px; padding: 10px; text-align: center; }
        .item.owned { border-color: #00f260; }
        .item.selected { border-color: #00d2ff; background: rgba(0, 210, 255, 0.1); box-shadow: 0 0 15px #00d2ff; }

        input { background: #222; border: 1px solid #555; color: white; padding: 10px; border-radius: 5px; text-align: center; font-family: inherit; margin-bottom: 20px; width: 200px; }
        .leaderboard { width: 90%; max-width: 300px; background: rgba(255,255,255,0.05); border-radius: 10px; padding: 10px; font-size: 12px; margin: 10px 0; }
        .row { display: flex; justify-content: space-between; padding: 4px 0; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .gold { color: #ffd700; }
    </style>
</head>
<body>

<canvas id="gameCanvas"></canvas>

<div id="hud" class="hidden">
    <div id="scoreDisplay">0</div>
    <div id="coinsDisplay" style="color:#ffd700">üí∞ 0</div>
    <div id="powerups" style="position: absolute; top: 50px; left: 15px; display: flex; flex-direction: column;"></div>
</div>

<div id="menuScreen" class="screen">
    <h1 style="font-size: 40px; background: -webkit-linear-gradient(#00f260, #0575e6); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">NEON DASH</h1>
    <div style="color: #666; font-size: 12px; margin-bottom: 10px;">GOD MODE EDITION</div>
    <input type="text" id="nickName" placeholder="–ù–ò–ö–ù–ï–ô–ú" maxlength="10">
    <div class="leaderboard" id="menuBoard">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    <button class="btn" onclick="Game.start()">–ò–ì–†–ê–¢–¨</button>
    <button class="btn btn-shop" onclick="UI.openShop()">–ú–ê–ì–ê–ó–ò–ù</button>
</div>

<div id="shopScreen" class="screen hidden">
    <h2>–ú–ê–ì–ê–ó–ò–ù</h2>
    <div style="color:#ffd700; margin-bottom:10px">–ë–∞–ª–∞–Ω—Å: <span id="shopBalance">0</span> üí∞</div>
    <div class="shop-grid" id="shopItems"></div>
    <button class="btn btn-small" onclick="UI.closeShop()">–ù–ê–ó–ê–î</button>
</div>

<div id="overScreen" class="screen hidden">
    <h2 style="color: #ff3333">GAME OVER</h2>
    <div id="finalScore" style="font-size: 50px; font-weight: 900;">0</div>
    <div style="color: #ffd700; margin-bottom: 15px;">+<span id="finalCoins">0</span> üí∞</div>
    <div class="leaderboard" id="overBoard"></div>
    <button class="btn" onclick="Game.start()">–ï–©–Å –†–ê–ó</button>
    <button class="btn btn-small" onclick="UI.toMenu()">–ú–ï–ù–Æ</button>
</div>

<script>
    // --- –ê–£–î–ò–û –°–ò–ù–¢–ï–ó–ê–¢–û–† (–ë–ï–ó –§–ê–ô–õ–û–í) ---
    const AudioSys = {
        ctx: null,
        init: () => { if(!AudioSys.ctx) AudioSys.ctx = new (window.AudioContext || window.webkitAudioContext)(); },
        play: (type) => {
            if(!AudioSys.ctx) return;
            const osc = AudioSys.ctx.createOscillator();
            const gain = AudioSys.ctx.createGain();
            osc.connect(gain); gain.connect(AudioSys.ctx.destination);
            
            const now = AudioSys.ctx.currentTime;
            if (type === 'jump') {
                osc.type = 'sine'; osc.frequency.setValueAtTime(300, now); osc.frequency.exponentialRampToValueAtTime(600, now + 0.1);
                gain.gain.setValueAtTime(0.1, now); gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                osc.start(now); osc.stop(now + 0.1);
            } else if (type === 'coin') {
                osc.type = 'square'; osc.frequency.setValueAtTime(1200, now); osc.frequency.setValueAtTime(1800, now + 0.05);
                gain.gain.setValueAtTime(0.05, now); gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                osc.start(now); osc.stop(now + 0.1);
            } else if (type === 'die') {
                osc.type = 'sawtooth'; osc.frequency.setValueAtTime(100, now); osc.frequency.exponentialRampToValueAtTime(10, now + 0.3);
                gain.gain.setValueAtTime(0.1, now); gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
                osc.start(now); osc.stop(now + 0.3);
            }
        }
    };

    // --- –ù–ê–°–¢–†–û–ô–ö–ò ---
    const CFG = { 
        binId: "22228939e981de6b7c03", 
        apiUrl: "https://api.npoint.io/22228939e981de6b7c03",
        skins: [
            {id:'cyan', c:'#00ffff', p:0, n:'Classic'},
            {id:'gold', c:'#ffd700', p:500, n:'Gold'},
            {id:'matrix', c:'#00ff00', p:200, n:'Matrix'},
            {id:'plasma', c:'#ff00aa', p:1000, n:'Plasma'},
            {id:'void', c:'#ffffff', p:2000, n:'Void'}
        ]
    };

    // --- –î–ê–ù–ù–´–ï ---
    let Data = JSON.parse(localStorage.getItem('neonGodData')) || { coins: 0, skins: ['cyan'], active: 'cyan', name: '' };
    if(Data.name) document.getElementById('nickName').value = Data.name;
    const save = () => localStorage.setItem('neonGodData', JSON.stringify(Data));

    // --- –ò–ì–†–û–í–û–ô –î–í–ò–ñ–û–ö ---
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    const Game = {
        active: false, frame: 0, score: 0, coins: 0, speed: 1, shake: 0,
        width: 0, height: 0,
        entities: [],
        player: { x:0, y:0, sz:30, trail:[], shield: false, magnet: false },
        
        resize: () => {
            Game.width = canvas.width = window.innerWidth;
            Game.height = canvas.height = window.innerHeight;
            Game.player.y = Game.height - 150;
            Game.player.x = Game.width / 2;
        },

        start: () => {
            AudioSys.init();
            Data.name = document.getElementById('nickName').value || "Guest"; save();
            Game.active = true; Game.score = 0; Game.coins = 0; Game.frame = 0; Game.speed = 1;
            Game.entities = [];
            Game.player.shield = false; Game.player.magnet = false; Game.player.trail = [];
            
            document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
            document.getElementById('hud').classList.remove('hidden');
            Game.loop();
        },

        loop: () => {
            if(!Game.active) return;
            requestAnimationFrame(Game.loop);
            
            // –¢—Ä—è—Å–∫–∞ —ç–∫—Ä–∞–Ω–∞
            let sx = 0, sy = 0;
            if(Game.shake > 0) {
                sx = (Math.random()-0.5)*Game.shake; sy = (Math.random()-0.5)*Game.shake;
                Game.shake *= 0.9;
            }
            ctx.setTransform(1,0,0,1,sx,sy);

            // –§–æ–Ω
            ctx.fillStyle = '#050505'; ctx.fillRect(-10, -10, Game.width+20, Game.height+20);
            Game.drawStars();

            Game.frame++;
            Game.score += 0.2;
            Game.speed = 1 + (Game.score/2000);

            // –ò–≥—Ä–æ–∫
            const skin = CFG.skins.find(s => s.id === Data.active);
            Game.player.x += (Input.x - Game.player.x) * 0.15;
            
            // –®–ª–µ–π—Ñ
            if(Game.frame%3===0) Game.player.trail.push({x:Game.player.x, y:Game.player.y, a:1});
            Game.player.trail.forEach((t, i) => {
                t.y += 2; t.a -= 0.05;
                ctx.fillStyle = skin.c; ctx.globalAlpha = Math.max(0, t.a);
                ctx.fillRect(t.x-15, t.y, 30, 30);
                if(t.a <= 0) Game.player.trail.splice(i,1);
            });
            ctx.globalAlpha = 1;

            // –†–∏—Å—É–µ–º –∏–≥—Ä–æ–∫–∞
            ctx.shadowBlur = 20; ctx.shadowColor = skin.c; ctx.fillStyle = skin.c;
            ctx.fillRect(Game.player.x-15, Game.player.y, 30, 30);
            ctx.shadowBlur = 0;

            // –©–∏—Ç
            if(Game.player.shield) {
                ctx.strokeStyle = '#00d2ff'; ctx.lineWidth = 3; ctx.beginPath();
                ctx.arc(Game.player.x, Game.player.y+15, 30, 0, Math.PI*2); ctx.stroke();
            }

            // –°–ø–∞–≤–Ω–µ—Ä
            Game.spawner();
            Game.updateEntities();
            
            document.getElementById('scoreDisplay').innerText = Math.floor(Game.score);
            document.getElementById('coinsDisplay').innerText = "üí∞ " + Game.coins;
        },

        drawStars: () => {
            ctx.fillStyle = 'rgba(255,255,255,0.15)';
            for(let i=0; i<30; i++) {
                let y = (Game.frame * (i%3+1) + i*100) % Game.height;
                let x = (i * 4523) % Game.width;
                ctx.fillRect(x, y, 2, 2);
            }
        },

        spawner: () => {
            if(Game.frame % Math.floor(50/Game.speed) === 0) {
                let r = Math.random();
                let type = 'normal';
                if(r > 0.8) type = 'zigzag';
                if(r > 0.95) type = 'chaser';
                Game.entities.push({type: 'enemy', etype: type, x: Math.random()*Game.width, y: -50, v: (4+Math.random())*Game.speed, t: 0, sx:0});
                let e = Game.entities[Game.entities.length-1]; e.sx = e.x;
            }
            if(Game.frame % 100 === 0) Game.entities.push({type: 'coin', x: Math.random()*Game.width, y: -50, v: 3*Game.speed});
            
            // PowerUps (—Ä–µ–¥–∫–æ)
            if(Game.frame % 900 === 0) {
                let ptypes = ['shield', 'magnet'];
                let p = ptypes[Math.floor(Math.random()*ptypes.length)];
                Game.entities.push({type: 'powerup', ptype: p, x: Math.random()*Game.width, y: -50, v: 3*Game.speed});
            }
        },

        updateEntities: () => {
            for(let i = Game.entities.length-1; i>=0; i--) {
                let e = Game.entities[i];
                
                // –î–≤–∏–∂–µ–Ω–∏–µ
                if(e.type === 'enemy') {
                    if(e.etype === 'zigzag') { e.t += 0.1; e.x = e.sx + Math.sin(e.t)*50; }
                    else if(e.etype === 'chaser') { e.x += (Game.player.x - e.x) * 0.02; }
                    e.y += e.v;
                } else if (e.type === 'coin' && Game.player.magnet) {
                    if(Math.hypot(Game.player.x - e.x, Game.player.y - e.y) < 200) {
                        e.x += (Game.player.x - e.x)*0.1; e.y += (Game.player.y - e.y)*0.1;
                    } else { e.y += e.v; }
                } else {
                    e.y += e.v;
                }

                // –û—Ç—Ä–∏—Å–æ–≤–∫–∞
                if(e.type === 'enemy') {
                    ctx.fillStyle = e.etype==='chaser' ? '#ff3300' : '#ff0055';
                    ctx.fillRect(e.x-15, e.y, 30, 30);
                } else if(e.type === 'coin') {
                    ctx.fillStyle = '#ffd700'; ctx.beginPath(); ctx.arc(e.x, e.y, 8, 0, Math.PI*2); ctx.fill();
                } else if(e.type === 'particle') {
                    e.x += e.vx; e.y += e.vy; e.life -= 0.05;
                    ctx.globalAlpha = e.life; ctx.fillStyle = e.c; ctx.fillRect(e.x, e.y, 4, 4);
                    ctx.globalAlpha = 1;
                    if(e.life <= 0) Game.entities.splice(i,1);
                    continue; 
                } else if(e.type === 'powerup') {
                    ctx.strokeStyle = e.ptype==='shield'?'#00d2ff':'#ff00ff';
                    ctx.lineWidth=2; ctx.beginPath(); ctx.arc(e.x, e.y, 12, 0, Math.PI*2); ctx.stroke();
                    ctx.font="12px sans-serif"; ctx.fillText(e.ptype==='shield'?'S':'M', e.x-5, e.y+4);
                }

                // –ö–æ–ª–ª–∏–∑–∏–∏
                let dist = Math.hypot(Game.player.x - e.x, (Game.player.y+15) - e.y);
                if(e.type !== 'particle' && dist < 30) {
                    if(e.type === 'coin') {
                        Game.coins++; AudioSys.play('coin');
                        Game.createParticles(e.x, e.y, '#ffd700');
                        Game.entities.splice(i,1);
                    } else if(e.type === 'powerup') {
                        Game.activatePowerup(e.ptype);
                        Game.entities.splice(i,1);
                    } else if(e.type === 'enemy') {
                        if(Game.player.shield) {
                            Game.player.shield = false;
                            Game.createParticles(e.x, e.y, '#ff0055');
                            Game.shake = 10;
                            Game.entities.splice(i,1);
                            AudioSys.play('die');
                        } else {
                            Game.shake = 20; AudioSys.play('die');
                            Game.over();
                        }
                    }
                }
                
                if(e.y > Game.height) Game.entities.splice(i,1);
            }
        },

        createParticles: (x, y, c) => {
            for(let k=0; k<10; k++) Game.entities.push({type:'particle', x, y, vx:(Math.random()-0.5)*10, vy:(Math.random()-0.5)*10, life:1, c});
        },

        activatePowerup: (type) => {
            AudioSys.play('jump');
            if(type === 'shield') Game.player.shield = true;
            if(type === 'magnet') {
                Game.player.magnet = true;
                setTimeout(() => Game.player.magnet = false, 5000);
            }
        },

        over: () => {
            Game.active = false;
            Data.coins += Game.coins; save();
            document.getElementById('finalScore').innerText = Math.floor(Game.score);
            document.getElementById('finalCoins').innerText = Game.coins;
            document.getElementById('hud').classList.add('hidden');
            document.getElementById('overScreen').classList.remove('hidden');
            Net.send(Data.name, Game.score);
        }
    };

    // --- –£–ü–†–ê–í–õ–ï–ù–ò–ï ---
    const Input = { x: window.innerWidth/2 };
    const handleMove = (x) => Input.x = x;
    window.addEventListener('mousemove', e => handleMove(e.clientX));
    window.addEventListener('touchmove', e => { e.preventDefault(); handleMove(e.touches[0].clientX); }, {passive:false});
    window.addEventListener('resize', Game.resize);
    Game.resize();

    // --- UI –ò –ú–ê–ì–ê–ó–ò–ù ---
    const UI = {
        openShop: () => {
            document.getElementById('menuScreen').classList.add('hidden');
            document.getElementById('shopScreen').classList.remove('hidden');
            document.getElementById('shopBalance').innerText = Data.coins;
            const con = document.getElementById('shopItems'); con.innerHTML = '';
            CFG.skins.forEach(s => {
                let own = Data.skins.includes(s.id);
                let sel = Data.active === s.id;
                let div = document.createElement('div');
                div.className = `item ${own?'owned':''} ${sel?'selected':''}`;
                div.innerHTML = `<div style="width:30px;height:30px;background:${s.c};margin:0 auto 5px;box-shadow:0 0 10px ${s.c}"></div>
                                 <b>${s.n}</b><br><small>${own ? (sel?'–í–´–ë–†–ê–ù–û':'–ö–£–ü–õ–ï–ù–û') : s.p+'üí∞'}</small>`;
                div.onclick = () => {
                    if(own) { Data.active = s.id; save(); UI.openShop(); }
                    else if(Data.coins >= s.p) {
                        Data.coins -= s.p; Data.skins.push(s.id); Data.active = s.id;
                        save(); UI.openShop();
                    }
                };
                con.appendChild(div);
            });
        },
        closeShop: () => {
            document.getElementById('shopScreen').classList.add('hidden');
            document.getElementById('menuScreen').classList.remove('hidden');
        },
        toMenu: () => {
            document.getElementById('overScreen').classList.add('hidden');
            document.getElementById('menuScreen').classList.remove('hidden');
            Net.get('menuBoard');
        }
    };

    // --- –°–ï–¢–¨ (NPOINT) ---
    const Net = {
        get: async (domId) => {
            const el = document.getElementById(domId);
            try {
                let r = await fetch(CFG.apiUrl + "?t=" + Date.now());
                let d = await r.json();
                if(!Array.isArray(d)) d = [];
                let h = '<div style="color:#00f260;margin-bottom:5px">–ì–õ–û–ë–ê–õ–¨–ù–´–ô –¢–û–ü</div>';
                d.slice(0,5).forEach((u,i) => h+=`<div class="row ${i===0?'gold':''}"><span>#${i+1} ${u.name}</span><span>${u.score}</span></div>`);
                el.innerHTML = h || "–ü—É—Å—Ç–æ";
            } catch(e) { el.innerHTML = "–û—Ñ—Ñ–ª–∞–π–Ω"; }
        },
        send: async (name, score) => {
            const el = document.getElementById('overBoard');
            el.innerHTML = "–û—Ç–ø—Ä–∞–≤–∫–∞...";
            try {
                let r = await fetch(CFG.apiUrl);
                let d = await r.json();
                if(!Array.isArray(d)) d = [];
                d.push({name, score: Math.floor(score)});
                d.sort((a,b)=>b.score-a.score);
                await fetch(CFG.apiUrl, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(d.slice(0,10))});
                Net.get('overBoard');
            } catch(e) { el.innerHTML = "–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å"; }
        }
    };

    Net.get('menuBoard');

</script>
</body>
</html>